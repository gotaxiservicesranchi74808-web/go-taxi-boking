<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GO TAXI SERVICES â€“ Driver Bookings</title>

<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
h2{color:#1e88e5;text-align:center}
.card{background:#fff;padding:15px;border-radius:8px;margin-bottom:15px;box-shadow:0 0 5px rgba(0,0,0,.1)}
.btn{padding:8px 12px;background:#1e88e5;color:#fff;border:none;border-radius:5px;cursor:pointer;margin-top:10px}
.btn:hover{background:#1565c0}
</style>
</head>

<body>

<h2>ðŸ“‹ My Assigned Bookings</h2>
<div id="list">Loadingâ€¦</div>

<script>
const driverMobile = (localStorage.getItem("driverMobile") || "").trim();
if(!driverMobile){
  alert("Please login first");
  window.location.href = "index.html";
}

const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzAb7zcLlk3j-S7bqVCvFROu2npYU-31524kalV9meMWWpn7UZ6CNnwQBT_saC5aNMzYA/exec";

fetch(SCRIPT_URL)
.then(res => res.json())
.then(result => {

  const bookings = result.data || [];

  console.log("Driver Mobile:", driverMobile);
  console.log("All bookings:", bookings);

  // ðŸ”¥ FINAL ROBUST FILTER (tumhara wala)
  const filteredBookings = bookings.filter(b => {
    const sheetMobile = String(b.Assigned_Driver_Mobile || "").trim();
    const status = String(b.Trip_Status || "").trim();
    return sheetMobile === driverMobile && status.toLowerCase() === "assigned";
  });

  console.log("Filtered bookings:", filteredBookings);

  if(filteredBookings.length === 0){
    document.getElementById("list").innerHTML = "<b>No assigned bookings</b>";
    return;
  }

  let html = "";
  filteredBookings.reverse().forEach(b => {
    html += `
    <div class="card">
      <b>Trip ID:</b> ${b.tripId}<br>
      <b>Trip Type:</b> ${b.tripType}<br>
      <b>Date:</b> ${formatDate(b.pickupDate)}<br>
      <b>Time:</b> ${b.pickupTime}<br><br>

      <b>Customer:</b> ${b.customerName} (${b.customerPhone})<br>
      <b>Route:</b> ${b.pickup} â†’ ${b.goingOn} â†’ ${b.drop}<br><br>

      <b>Cab:</b> ${b.cabType} (${b.cabNo})<br><br>

      <b>Total:</b> â‚¹${b.totalAmount} |
      <b>Balance:</b> â‚¹${b.balance}<br><br>

      <button class="btn" onclick='startTrip(${JSON.stringify(b)})'>
        Start Trip
      </button>
    </div>
    `;
  });

  document.getElementById("list").innerHTML = html;
})
.catch(err=>{
  console.error(err);
  document.getElementById("list").innerHTML = "Error loading data";
});

function formatDate(d){
  if(!d) return "";
  return new Date(d).toLocaleDateString("en-IN");
}

function startTrip(b){
  localStorage.setItem("activeBooking", JSON.stringify(b));
  window.location.href = "trip-start.html";
}
</script>

</body>
</html>

