<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz8KlhAXfQiAPqnvad-vNgtnD_SM4CEbZudneBRCDmoF8v3tPvTvvDwGCGXQzDw7nkiEw/exec";

const driverMobile = (localStorage.getItem("driverMobile") || "").trim();
console.log("Driver Mobile:", driverMobile);

fetch(SCRIPT_URL)
.then(r => r.json())
.then(bookings => {

  console.log("All bookings:", bookings);

  const filteredBookings = bookings.filter(b => {
    const phone = String(b.driverPhone || "").trim();
    return phone === driverMobile;
  });

  console.log("Filtered bookings:", filteredBookings);

  if(filteredBookings.length === 0){
    document.getElementById("list").innerHTML = "<b>No booking found</b>";
    return;
  }

  let html = "";
  filteredBookings.forEach(b => {
    html += `
      <div class="card">
        <b>Trip ID:</b> ${b.tripId}<br>
        <b>Trip:</b> ${b.tripType}<br>
        <b>Date:</b> ${new Date(b.pickupDate).toLocaleDateString("en-IN")}<br>
        <b>Time:</b> ${b.pickupTime}<br><br>

        <b>Customer:</b> ${b.customerName} (${b.customerPhone})<br>
        <b>Route:</b> ${b.pickup} → ${b.drop}<br><br>

        <b>Cab:</b> ${b.cabType} (${b.cabNo})<br>
        <b>Total:</b> ₹${b.totalAmount}<br><br>

        <button class="btn" onclick='startTrip(${JSON.stringify(b)})'>
          Start Trip
        </button>
      </div>
    `;
  });

  document.getElementById("list").innerHTML = html;
})
.catch(err=>{
  console.error(err);
  document.getElementById("list").innerHTML = "Error loading data";
});

function startTrip(b){
  localStorage.setItem("activeBooking", JSON.stringify(b));
  window.location.href = "trip-start.html";
}
</script>
