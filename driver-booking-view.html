<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GO TAXI SERVICES â€“ Driver Bookings</title>

<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
h2{color:#1e88e5;text-align:center}
.card{
  background:#fff;
  padding:15px;
  border-radius:8px;
  margin-bottom:15px;
  box-shadow:0 0 5px rgba(0,0,0,.1)
}
.btn{
  padding:8px 12px;
  background:#1e88e5;
  color:#fff;
  border:none;
  border-radius:5px;
  cursor:pointer;
}
</style>
</head>

<body>

<h2>ðŸ“‹ My Bookings</h2>

<!-- ðŸ”´ THIS WAS MISSING â€“ NOW FIXED -->
<div id="list">Loadingâ€¦</div>

<script>
const SCRIPT_URL =
"https://script.google.com/macros/s/AKfycbz8KlhAXfQiAPqnvad-vNgtnD_SM4CEbZudneBRCDmoF8v3tPvTvvDwGCGXQzDw7nkiEw/exec";

const driverMobile = (localStorage.getItem("driverMobile") || "").trim();
console.log("Driver Mobile:", driverMobile);

if(!driverMobile){
  alert("Please login first");
  window.location.href="index.html";
}

fetch(SCRIPT_URL)
.then(r => r.json())
.then(bookings => {

  console.log("All bookings:", bookings);

  const filtered = bookings.filter(b =>
    String(b.driverPhone || "").trim() === driverMobile
  );

  console.log("Filtered bookings:", filtered);

  if(filtered.length === 0){
    document.getElementById("list").innerHTML =
      "<b>No booking found</b>";
    return;
  }

  let html = "";
  filtered.forEach(b => {
    html += `
      <div class="card">
        <b>Trip ID:</b> ${b.tripId}<br>
        <b>Trip:</b> ${b.tripType}<br>
        <b>Date:</b> ${new Date(b.pickupDate).toLocaleDateString("en-IN")}<br>
        <b>Time:</b> ${b.pickupTime}<br><br>

        <b>Customer:</b> ${b.customerName} (${b.customerPhone})<br>
        <b>Route:</b> ${b.pickup} â†’ ${b.drop}<br><br>

        <b>Cab:</b> ${b.cabType} (${b.cabNo})<br>
        <b>Total:</b> â‚¹${b.totalAmount}<br><br>

        <button class="btn" onclick='startTrip(${JSON.stringify(b)})'>
          Start Trip
        </button>
      </div>
    `;
  });

  document.getElementById("list").innerHTML = html;
})
.catch(err=>{
  console.error(err);
  document.getElementById("list").innerHTML =
    "<b>Error loading data</b>";
});

function startTrip(b){
  localStorage.setItem("activeBooking", JSON.stringify(b));
  alert("Trip Started for " + b.tripId);
  // next page later
}
</script>

</body>
</html>
